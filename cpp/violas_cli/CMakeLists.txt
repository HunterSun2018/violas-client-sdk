cmake_minimum_required(VERSION 3.0)

project(violas-cli VERSION 1.0)

set(CMAKE_CXX_STANDARD 17)

aux_source_directory(src SRCS)

include_directories(../../rust/violas-client/src/ffi)
include_directories(../include)

# obj file generated by Rust
set(OBJ_FROM_RUST
  ${CMAKE_CURRENT_SOURCE_DIR}/../../rust/violas-client/target/release/build/violas-client-c45e8aab37bfb9f5/out/rust_cpp/cpp_closures.o
)

# SET_SOURCE_FILES_PROPERTIES(
#   ${OBJS}
#   PROPERTIES
#   EXTERNAL_OBJECT true
#   GENERATED true
# )

# link directories
link_directories(../../rust/violas-client/target/release)

# executable file
add_executable(violas-cli  ${SRCS})

# link all libs
target_link_libraries(violas-cli readline pthread violas_client ssl crypto ${OBJ_FROM_RUST})

# install
install(TARGETS violas-cli
        RUNTIME DESTINATION bin
        LIBRARY DESTINATION lib
        ARCHIVE DESTINATION lib
        PUBLIC_HEADER DESTINATION include)

# run cmake for debug 
#   cmake -Bbuild/debug -DCMAKE_BUILD_TYPE=Debug 
# run cmake for release
#   cmake -Bbuild/release -DCMAKE_BUILD_TYPE=Release  -DCMAKE_INSTALL_PREFIX=./build/release 
